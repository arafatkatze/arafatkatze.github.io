<!-- Floating Contact Button -->
<button class="contact-fab" onclick="openContactModal()" aria-label="Contact me">
  <i class="fa-solid fa-envelope"></i>
</button>

<!-- Contact Modal -->
<div id="contactModal" class="contact-modal" onclick="closeContactModalOutside(event)">
  <div class="contact-modal-content">
    <button class="contact-modal-close" onclick="closeContactModal()" aria-label="Close">&times;</button>
    
    <!-- Form State -->
    <div id="contactFormState">
      <h4 class="contact-modal-title">Get in Touch</h4>
      <p class="contact-modal-subtitle">Some of my best relationships started with a random message out of the blue. Whether you want to reconnect, share something, or just say hello  I'm here and I'd love to hear from you. I read everything and I always respond.</p>
      <form id="contactForm" class="contact-form">
        <div class="form-group">
          <input
            type="email"
            name="email"
            id="contactEmail"
            class="form-control contact-input"
            placeholder="Your email"
            required
          >
          <span id="emailError" class="contact-error" style="display: none;">Please enter a valid email address</span>
        </div>
        <div class="form-group">
          <textarea
            name="message"
            id="contactMessage"
            class="form-control contact-textarea"
            placeholder="Your message"
            rows="4"
            required
          ></textarea>
        </div>
        <button type="submit" class="btn contact-submit-btn" id="contactSubmitBtn">Send Message</button>
        <span id="submitError" class="contact-error" style="display: none; margin-top: 10px;">Something went wrong. Please try again.</span>
      </form>
    </div>
    
    <!-- Success State -->
    <div id="contactSuccessState" style="display: none; text-align: center; padding: 20px 0;">
      <div style="font-size: 2.5rem; margin-bottom: 16px; color: var(--global-theme-color);"><i class="fa-solid fa-check-circle"></i></div>
      <h4 class="contact-modal-title">Message Sent!</h4>
      <p class="contact-modal-subtitle" style="margin-bottom: 0;">Thanks for reaching out. I'll get back to you soon!</p>
    </div>
    
  </div>
</div>

<script>
function openContactModal() {
  document.getElementById('contactModal').classList.add('open');
  document.body.style.overflow = 'hidden';
  // Reset to form state when opening
  document.getElementById('contactFormState').style.display = 'block';
  document.getElementById('contactSuccessState').style.display = 'none';
  // Clear any previous errors
  document.getElementById('emailError').style.display = 'none';
  document.getElementById('submitError').style.display = 'none';
  document.getElementById('contactEmail').classList.remove('input-error');
}

function closeContactModal() {
  document.getElementById('contactModal').classList.remove('open');
  document.body.style.overflow = '';
}

function closeContactModalOutside(event) {
  if (event.target.id === 'contactModal') {
    closeContactModal();
  }
}

// Close on Escape key
document.addEventListener('keydown', function(event) {
  if (event.key === 'Escape') {
    closeContactModal();
  }
});

// Email validation function
function isValidEmail(email) {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
}

// Clear error on input
document.getElementById('contactEmail').addEventListener('input', function() {
  document.getElementById('emailError').style.display = 'none';
  this.classList.remove('input-error');
});

// Handle form submission with AJAX
document.getElementById('contactForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const form = e.target;
  const emailInput = document.getElementById('contactEmail');
  const emailError = document.getElementById('emailError');
  const submitError = document.getElementById('submitError');
  const submitBtn = document.getElementById('contactSubmitBtn');
  
  // Clear previous errors
  emailError.style.display = 'none';
  submitError.style.display = 'none';
  emailInput.classList.remove('input-error');
  
  // Validate email
  if (!isValidEmail(emailInput.value)) {
    emailError.style.display = 'block';
    emailInput.classList.add('input-error');
    emailInput.focus();
    return;
  }
  
  const formData = new FormData(form);
  
  // Disable button and show loading
  submitBtn.disabled = true;
  submitBtn.textContent = 'Sending...';
  
  fetch('https://formspree.io/f/mqeenowa', {
    method: 'POST',
    body: formData,
    headers: {
      'Accept': 'application/json'
    }
  })
  .then(response => {
    if (response.ok) {
      // Show success state
      document.getElementById('contactFormState').style.display = 'none';
      document.getElementById('contactSuccessState').style.display = 'block';
      // Reset form
      form.reset();
    } else {
      throw new Error('Form submission failed');
    }
  })
  .catch(error => {
    submitError.style.display = 'block';
  })
  .finally(() => {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Send Message';
  });
});
</script>
